webpackJsonp([28],{"4pZS":function(e,t,o){var r=o("58gO");r(r.S,"Object",{is:o("xrZo")})},Gn17:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{staticClass:"heightDialog",attrs:{title:(1==e.openType?"新增":"编辑")+"收货单",visible:e.isVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"lock-scroll":!0,width:"95%",top:"5vh","before-close":e.cancel},on:{"update:visible":function(t){e.isVisible=t},close:e.cancel}},[o("el-form",{ref:"orderInfo",attrs:{model:e.orderInfo,rules:e.orderFormRules,"label-width":"60px"}},[o("el-row",[o("el-col",{attrs:{span:5}},[o("el-form-item",{attrs:{label:"商户",prop:"goodsReceiveMerchantId"}},[o("el-select",{attrs:{placeholder:"请选择商户",filterable:""},on:{change:e.changeMerchants},model:{value:e.orderInfo.goodsReceiveMerchantId,callback:function(t){e.$set(e.orderInfo,"goodsReceiveMerchantId",t)},expression:"orderInfo.goodsReceiveMerchantId"}},e._l(e.merchantsList,function(e,t){return o("el-option",{key:t,attrs:{disabled:e.disabled,label:e.userName,value:e.userUuid}})}),1)],1)],1),e._v(" "),o("el-col",{attrs:{span:5}},[o("el-form-item",{attrs:{label:"类型",prop:"goodsReceiveType"}},[o("el-select",{staticClass:"w100p",attrs:{placeholder:"请选择收货单类型"},model:{value:e.orderInfo.goodsReceiveType,callback:function(t){e.$set(e.orderInfo,"goodsReceiveType",t)},expression:"orderInfo.goodsReceiveType"}},[o("el-option",{staticClass:"radio",attrs:{value:"1",label:"采购入库"}}),e._v(" "),o("el-option",{staticClass:"radio",attrs:{value:"2",label:"搬仓入库"}}),e._v(" "),o("el-option",{staticClass:"radio",attrs:{value:"3",label:"提货入库"}}),e._v(" "),o("el-option",{staticClass:"radio",attrs:{value:"4",label:"售后入库"}}),e._v(" "),o("el-option",{staticClass:"radio",attrs:{value:"5",label:"展厅下样入库"}}),e._v(" "),o("el-option",{staticClass:"radio",attrs:{value:"6",label:"展厅撤场入库"}})],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:7}},[o("el-form-item",{attrs:{label:"送达日期",prop:"goodsReceiveDate","label-width":"90px"}},[o("el-date-picker",{staticClass:"w100p",attrs:{align:"right",type:"date",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.orderInfo.goodsReceiveDate,callback:function(t){e.$set(e.orderInfo,"goodsReceiveDate",t)},expression:"orderInfo.goodsReceiveDate"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:7}},[o("el-form-item",{attrs:{label:"备注",prop:"goodsReceiveRemark"}},[o("el-input",{staticClass:"create_textarea",attrs:{type:"textarea",autosize:{maxRows:3},maxlength:"200",resize:"none",placeholder:"请输入收货单备注，最长200字符"},model:{value:e.orderInfo.goodsReceiveRemark,callback:function(t){e.$set(e.orderInfo,"goodsReceiveRemark",t)},expression:"orderInfo.goodsReceiveRemark"}})],1)],1)],1),e._v(" "),o("el-row",[o("div",[o("common-table",{attrs:{flex:300}},[o("template",{slot:"table"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isListLoading,expression:"isListLoading"}],ref:"orderTable",attrs:{height:"100%",stripe:"",border:!0,data:e.tableData}},[o("el-table-column",{attrs:{type:"index",label:"序号",width:"50",fixed:"left","header-align":"center"}}),e._v(" "),o("el-table-column",{attrs:{label:"品牌",prop:"productBrand"}}),e._v(" "),o("el-table-column",{attrs:{label:"型号",prop:"productModel"}}),e._v(" "),o("el-table-column",{attrs:{label:"货品名称",prop:"productName"}}),e._v(" "),o("el-table-column",{attrs:{label:"规格",prop:"productStandard"}}),e._v(" "),o("el-table-column",{attrs:{label:"颜色",prop:"productColor"}}),e._v(" "),o("el-table-column",{attrs:{label:"货品类型","header-align":"center","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{disabled:t.row.typeDisabled,placeholder:"请选择"},model:{value:t.row.productType,callback:function(o){e.$set(t.row,"productType",o)},expression:"scope.row.productType"}},[o("el-option",{attrs:{value:"0",label:"小件"}}),e._v(" "),o("el-option",{attrs:{value:"1",disabled:!0,label:"套件"}}),e._v(" "),o("el-option",{attrs:{value:"2",label:"单品"}})],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"包装形式","header-align":"center","min-width":"110",formatter:e.PackFormatter},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{disabled:"1"!=e.openType,placeholder:"请选择"},model:{value:t.row.receiveItemPack,callback:function(o){e.$set(t.row,"receiveItemPack",o)},expression:"scope.row.receiveItemPack"}},e._l(e.packagedType,function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"子件","min-width":"120","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.productItemUuid&&"1"==t.row.productType?o("el-tooltip",{attrs:{placement:"top",effect:"light",enterable:"","visible-arrow":!1}},[o("div",{attrs:{slot:"content"},slot:"content"},[o("div",[e._v("\n                  "+e._s(e.getItemName(t.row.productItemUuid))+"\n                ")])]),e._v(" "),"1"==t.row.productType?o("el-select",{on:{change:function(o){return e.changeModel(t.row,t.$index)}},model:{value:t.row.productItemUuid,callback:function(o){e.$set(t.row,"productItemUuid",o)},expression:"scope.row.productItemUuid"}},e._l(t.row.productItems,function(e,t){return o("el-option",{key:t,attrs:{disabled:!1,label:e.productItemName,value:e.productItemUuid}})}),1):e._e()],1):e._e(),e._v(" "),t.row.productItemUuid||"1"!=t.row.productType?e._e():o("el-select",{on:{change:function(o){return e.changeModel(t.row,t.$index)}},model:{value:t.row.productItemUuid,callback:function(o){e.$set(t.row,"productItemUuid",o)},expression:"scope.row.productItemUuid"}},e._l(t.row.productItems,function(e,t){return o("el-option",{key:t,attrs:{disabled:e.disabled,label:e.productItemName,value:e.productItemUuid}})}),1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"数量","header-align":"center","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input-number",{staticClass:"productCount",attrs:{"controls-position":"right",min:1,max:99999,size:"mini"},model:{value:t.row.receiveItemCount,callback:function(o){e.$set(t.row,"receiveItemCount",o)},expression:"scope.row.receiveItemCount"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"备注","min-width":"140","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{staticClass:"create_textarea",attrs:{type:"textarea",autosize:{maxRows:2},maxlength:"200",resize:"none",placeholder:"最长200字符"},model:{value:t.row.receiveItemRemark,callback:function(o){e.$set(t.row,"receiveItemRemark",o)},expression:"scope.row.receiveItemRemark"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{"render-header":e.renderHeader,fixed:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",rules:"small"},nativeOn:{click:function(o){return o.preventDefault(),e.deleteRow(t.$index,t.row)}}},[e._v("\n                删除\n              ")])]}}])})],1)],1)],2)],1)]),e._v(" "),o("el-row",[o("el-col",{staticClass:"text-r mar-t-10",attrs:{span:5,offset:19}},[o("el-button",{attrs:{type:"primary",loading:e.isSaveing},on:{click:function(t){return e.save()}}},[e._v("提交")]),e._v(" "),o("el-button",{on:{click:function(t){return e.cancel()}}},[e._v("取消")])],1)],1)],1)],1),e._v(" "),o("template-create",{staticClass:"highIndex",attrs:{show:e.isCreateTemplateshow,searchParams:e.searchParams,merchantsList:e.merchantsList,merchants:e.orderInfo.goodsReceiveMerchantId,brandList:e.brandList,warehouseList:e.warehouseList},on:{"update:show":function(t){e.isCreateTemplateshow=t},sendDataOut:e.receiveData,reset:e.resetRow}}),e._v(" "),o("template-import",{attrs:{show:e.importVisible,merchantsList:e.merchantsList},on:{"update:show":function(t){e.importVisible=t},updateList:e.queryList}}),e._v(" "),o("template-select",{attrs:{show:e.isTemplateShow,merchantsList:e.merchantsList,merchantId:e.orderInfo.goodsReceiveMerchantId},on:{"update:show":function(t){e.isTemplateShow=t},sendData:e.receiveData}})],1)},staticRenderFns:[]}},Js8z:function(e,t){},VQjE:function(e,t,o){o("4pZS"),e.exports=o("aftD").Object.is},X1IT:function(e,t,o){e.exports={default:o("VQjE"),__esModule:!0}},g9Ix:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("4YfN"),a=o.n(r),i=o("X1IT"),n=o.n(i),s=o("YTJj"),l=o.n(s),c=o("HzJ8"),d=o.n(c),u=o("rVsN"),p=o.n(u),f=o("aA9S"),h=o.n(f),m=o("aIe1"),v=o("VkjD"),b=o("ycWN"),g=o("Q8cT"),I=o("I8tE"),y=o("Ips9"),w=o("4+6g"),x=o("fBur"),_=o("rHLQ"),M={receiveItemPack:"1",receiveItemCount:"1"},T={name:"OrderCreate",data:function(){return{originalData:{},isSaveing:!1,createIndex:"",isCreateTemplateshow:!1,isVisible:!1,orderInfo:{},isListLoading:!1,packagedType:[{value:"1",label:"有包装"},{value:"2",label:"无包装"},{value:"3",label:"其他"}],originModel:[],existModel:[],modelBrand:[],brandList:[],modelList:[],tableData:[],orderFormRules:{goodsReceiveMerchantId:[{required:!0,message:"请选择商户",trigger:"blur"}],goodsReceiveType:[{required:!0,message:"请选择订单类型",trigger:"blur"}],goodsReceiveDate:[{required:!0,message:"请选择送达时间",trigger:"blur"}]},importVisible:!1,hasSaved:!1,selectIndex:"",isTemplateShow:!1}},props:{show:{type:Boolean,default:!1},openType:{type:Number,default:1},selectedOrderInfo:{type:Object},warehouseList:{type:Array},merchantsList:{type:Array},searchParams:{type:Object}},watch:{show:function(e){var t=this;e&&(2===this.openType||3===this.openType?(this.originalData=h()({},this.selectedOrderInfo),this.orderInfo=h()({},this.selectedOrderInfo),this.orderInfo.goodsReceiveItems.forEach(function(e){e.productUuid=e.receiveItemProductId}),this.tableData=[].concat(this.orderInfo.goodsReceiveItems),this.tableData.forEach(function(e){""!=e.productType&&(e.typeDisabled=!0),t.changeModel(e)})):this.tableData=[]),this.isVisible=e}},methods:{changeMerchants:function(e){this.tableData=[],this.existModel=[],this.originModel=[],this.getBrandModel({warehouseUuid:Object(x.b)("warehouseUuid"),merchantUuid:e})},getBrandModel:function(e){var t=this;Object(w.h)(e).then(function(e){e.error||(t.brandList=[],t.modelList=[],e.forEach(function(e,o){t.brandList.push(e.productBrand),e.productModel.forEach(function(e){t.modelList.push(e)})}),t.modelBrand=e)})},getTemplate:function(){var e=this;return new p.a(function(t){var o={merchantUuid:e.orderInfo.goodsReceiveMerchantId};e.isListLoading=!0,Object(I.g)(o).then(function(o){e.isListLoading=!1,e.originModel=[],e.originModel=e.originModel.concat(o);var r=function(e){delete e.descOrAsc,delete e.orderBy,delete e.pageNum,delete e.pageSize,delete e.productItemUuid,e.disabled=!1,""==e.productType?e.typeDisabled=!1:e.typeDisabled=!0,"1"==e.productType&&e.productItems.length&&e.productItems.forEach(function(t){t.disabled=!1,e.productItemUuid=e.productItems[0].productItemUuid})},a=!0,i=!1,n=void 0;try{for(var s,l=d()(e.originModel);!(a=(s=l.next()).done);a=!0){r(s.value)}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}e.originModel.unshift({productUuid:"新增",productModel:"新增"}),t()})})},renderHeader:function(e,t){var o=this;return l()(t),e("el-button",{class:["addBtn","el-button--primary"],domProps:{innerHTML:"添加货品"},on:{click:function(){o.addRow()}}})},addRow:function(){this.orderInfo.goodsReceiveMerchantId?(this.isTemplateShow=!0,this.selectIndex=this.tableData.length):this.$message({type:"warning",message:"请选择商户"})},deleteRow:function(e,t){"1"==t.productType&&t.productItems&&t.productItems.length&&this.tableData.forEach(function(e){e.productUuid==t.productUuid&&e.productItems.forEach(function(e){e.productItemUuid==t.productItemUuid&&(e.disabled=!1)})}),this.tableData.splice(e,1)},receiveData:function(e){var t=this;e.forEach(function(e){if(""!==e.productType&&(e.typeDisabled=!0),"1"==(e=h()(e,M)).productType&&e.productItems&&e.productItems.length)e.productItems.forEach(function(o){e.productItemUuid=o.productItemUuid,o.disabled=!0;var r=h()({},e);t.tableData.unshift(r),t.changeModel(r),t.selectIndex++});else if("1"!=e.productType){var o=h()({},e);t.tableData.unshift(o),t.selectIndex++}})},resetRow:function(e){e||(M.productUuid="",this.$set(this.existModel,this.createIndex,this.originModel),this.$set(this.tableData,this.createIndex,M))},cancel:function(){var e=this;!this.hasSaved&&n()(this.originalData,this.orderInfo)?this.$confirm("确认要取消编辑吗？","提醒",{confirmButtonText:"确定",cancelButtonText:"继续编辑"}).then(function(){e.existModel=[],e.originModel=[],e.tableData=[],e.orderInfo={},e.originalData={},e.$refs.orderInfo.resetFields(),e.$emit("update:show",!1),e.isVisible=!1}).catch(function(){}):(this.existModel=[],this.originModel=[],this.tableData=[],this.orderInfo={},this.originalData={},this.$refs.orderInfo.resetFields(),this.$emit("update:show",!1),this.isVisible=!1)},dealModel:function(e,t){""!==e?(this.existModel=this.originModel.filter(function(t){return t.productBrand===e}),this.existModel.unshift({productUuid:"新建",productModel:"新建"})):""===e&&(this.existModel=[].concat(this.originModel))},changeModel:function(e){if("1"==e.productType&&e.productItems&&e.productItems.length){var t=[],o=this.tableData.filter(function(t){return t.productUuid==e.productUuid});o&&o.length&&o.forEach(function(e){t.push(e.productItemUuid)}),this.tableData.forEach(function(o){o.productUuid==e.productUuid&&o.productItems.forEach(function(e){var o=t.find(function(t){return t==e.productItemUuid});e.disabled=!!o})})}},changeItem:function(e,t){var o=this.tableData.filter(function(t){return t.productUuid===e.productUuid});o&&o.length&&this.existModel.forEach(function(e){e.forEach(function(e){"1"===e.productType&&e.productItems.forEach(function(e){var t=o.find(function(t){return t.productItemUuid===e.productItemUuid});e.disabled=!!t})})})},getItemName:function(e){var t=this.tableData.find(function(t){return t.productItemUuid==e});if(t){var o=t.productItems.find(function(t){return t.productItemUuid==e});if(o)return o.productItemName}},save:function(){var e=this;this.$refs.orderInfo.validate(function(t){if(t){if(!e.tableData.length)return void e.$message({message:"请补全货物信息",type:"warning"});var o=!0,r=!1,i=void 0;try{for(var n,s=d()(e.tableData);!(o=(n=s.next()).done);o=!0){var l=n.value;if(l.receiveItemProductId=l.productUuid,delete l.productItems,!l||!l.productUuid||""===l.productUuid)return void e.$message({message:"请补全货物信息",type:"warning"});if(""==l.productType)return void e.$message({message:"请选择货品类型",type:"warning"})}}catch(e){r=!0,i=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}var c=a()({},e.orderInfo,{goodsWarehouseUuid:Object(x.b)("warehouseUuid"),goodsReceiveMerchant:e.merchantsList.find(function(t){return t.userUuid===e.orderInfo.goodsReceiveMerchantId}).userName,goodsReceiveItems:e.tableData});e.isSaveing=!0,Object(y.o)(c).then(function(t){if(e.isSaveing=!1,!t.error){var o=1==e.openType?"新增":"编辑";e.$message({message:o+"成功!",type:"success"}),e.hasSaved=!0,e.cancel(),e.queryList()}})}})},PackFormatter:function(e){return"1"===e.receiveItemPack?"有包装":"0"===e.receiveItemPack?"无包装":"未知"},uploadProd:function(){this.importVisible=!0},queryList:function(){this.$emit("search",this.searchParams)},printCode:function(){var e=this;this.paramsList=[],this.tableData.forEach(function(t){e.paramsList.push(t.productUuid)}),this.qrCodeVisible=!0},dealItemName:function(e){var t="";return"1"==e.productType&&e.productItems.length?(t="子件:",e.productItems.forEach(function(o,r){t+=o.productItemName+(r===e.productItems.length-1?"":"、")})):"0"==e.productType?t="小件":"2"==e.productType&&(t="单品"),t}},components:{QrCode:_.default,CommonTable:m.a,TemplateCreate:v.default,TemplateImport:b.default,TemplateSelect:g.default}},U=o("Gn17"),k=o.n(U);var D=function(e){o("Js8z")},R=o("C7Lr")(T,k.a,!1,D,"data-v-0611b5a4",null);t.default=R.exports},xrZo:function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}});
//# sourceMappingURL=28.d7149a923f2a002b6e89.js.map