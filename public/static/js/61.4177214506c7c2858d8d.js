webpackJsonp([61],{"6LEZ":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("4YfN"),a=r.n(o),l=r("YTJj"),n=r.n(l),d=r("HzJ8"),s=r.n(d),i=r("rVsN"),u=r.n(i),c=r("aA9S"),p=r.n(c),m=r("uTPb"),f=r("XQ4b"),h=r("aIe1"),I=r("qwBq"),v=r("VkjD"),g=r("ycWN"),b=(r("I8tE"),r("Ips9")),T=r("4+6g"),y=r("fBur"),w={name:"OrderCreate",data:function(){return{isSaveing:!1,createIndex:"",isCreateTemplateshow:!1,isVisible:!1,orderInfo:{goodsDeliverMerchantName:"",goodsDeliverMerchantUuid:"",goodsDeliverType:"",goodsDeliverDate:"",customerName:"",customerAddress:"",customerTelephone:"",warehouseName:"",warehouseUuid:"",goodsDeliverRemark:"",customerServicePhone:"",customerLiftFlag:"",customerNeedInstall:""},isListLoading:!1,goodsDeliverType:[{value:"1",label:"仓库出货"},{value:"2",label:"自提"}],originModel:[],existModel:[],modelBrand:[],brandList:[],modelList:[],tableData:[],orderFormRules:{goodsDeliverMerchantUuid:[{required:!0,message:"请选择商户",trigger:"blur"}],goodsDeliverType:[{required:!0,message:"请选择订单类型",trigger:"blur"}],goodsDeliverDate:[{required:!0,message:"请选择送货日期",trigger:"blur"}],customerNeedInstall:[{required:!0,message:"请选择是否安装",trigger:"blur"}]},importVisible:!1,isMapShow:!1,addressInfo:{},fromEdit:!1,isTemplateShow:!1}},props:{show:{type:Boolean,default:!1},openType:{type:Number,default:1},warehouseList:{type:Array},merchantsList:{type:Array},selectedOrderInfo:{type:Object},searchParams:{type:Object},existOrder:{type:Array}},watch:{show:function(e){this.orderInfo={},2===this.openType&&e?(this.orderInfo=p()({},this.selectedOrderInfo),this.getDeliverDetail({deliverOrderId:this.selectedOrderInfo.goodsDeliverUuid})):this.tableData=[],this.isVisible=e}},methods:{getDeliverDetail:function(e){var t=this;this.isListLoading=!0,Object(b.i)(e).then(function(e){t.isListLoading=!1,e.error||(t.tableData=e,t.tableData.forEach(function(e){t.changeModel(e)}))})},deliverTypeChange:function(e){this.$refs.orderInfo.clearValidate(),1==e?(console.log(this.orderFormRules),this.orderFormRules=p()(this.orderFormRules,{customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],customerAddress:[{required:!0,message:"请输入客户地址",trigger:"blur"}],customerTelephone:[{required:!0,message:"请输入客户电话",trigger:"blur"},{validator:m.a.isCellAndTel,trigger:"blur"}]})):(delete this.orderFormRules.customerName,delete this.orderFormRules.customerTelephone,delete this.orderFormRules.customerAddress,this.orderFormRules=p()(this.orderFormRules,{customerTelephone:[{validator:m.a.isCellAndTel,trigger:"blur"}]}))},changeMerchants:function(e){this.tableData=[],this.existModel=[],this.originModel=[],this.getBrandModel({warehouseUuid:Object(y.b)("warehouseUuid"),merchantUuid:e});var t=this.existOrder.find(function(t){return t.goodsDeliverMerchantUuid==e});1==this.openType&&t?(this.forbidden=!0,this.$alert("此商户存在未审核通过的出库单，请审核通过后再新增出库单","提示",{confirmButtonText:"确定"})):this.forbidden=!1},getBrandModel:function(e){var t=this;Object(T.h)(e).then(function(e){e.error||(t.brandList=[],t.modelList=[],e.forEach(function(e,r){t.brandList.push(e.productBrand),e.productModel.forEach(function(e){t.modelList.push(e)})}),t.modelBrand=e)})},getTemplate:function(){var e=this;return new u.a(function(t){var r={merchantUuid:e.orderInfo.goodsDeliverMerchantUuid,warehouseUuid:e.orderInfo.warehouseUuid?e.orderInfo.warehouseUuid:Object(y.b)("warehouseUuid")};e.isListLoading=!0,Object(b.k)(r).then(function(r){if(e.isListLoading=!1,e.originModel=[],e.originModel=r,e.originModel&&e.originModel.length>0){var o=function(e){e.productTempleteId=e.productUuid,e.remark&&(e.goodsDeliverRemark=e.remark),e.disabled=!1,delete e.descOrAsc,delete e.orderBy,delete e.pageNum,delete e.pageSize,"1"==e.productType&&e.productItems.length&&e.productItems.forEach(function(t){t.disabled=!1,e.remark&&(t.goodsDeliverRemark=e.remark),e.productItemUuid=e.productItems[0].productItemUuid})},a=!0,l=!1,n=void 0;try{for(var d,i=s()(e.originModel);!(a=(d=i.next()).done);a=!0){o(d.value)}}catch(e){l=!0,n=e}finally{try{!a&&i.return&&i.return()}finally{if(l)throw n}}}t()})})},renderHeader:function(e,t){var r=this;return n()(t),e("el-button",{class:["addBtn","el-button--primary"],domProps:{innerHTML:"添加货品"},on:{click:function(){r.addRow()}}})},addRow:function(){this.orderInfo.goodsDeliverMerchantUuid?this.forbidden?this.$alert("此商户存在未审核通过的出库单，请审核通过后再新增出库单","提示",{confirmButtonText:"确定"}):(this.isTemplateShow=!0,this.selectIndex=this.tableData.length):this.$message({type:"warning",message:"请选择商户"})},deleteRow:function(e,t){"1"==t.productType&&t.productItems&&t.productItems.length&&this.tableData.forEach(function(e){e.productTempleteId==t.productTempleteId&&e.productItems.forEach(function(e){e.productItemUuid==t.productTempleteItemId&&(e.disabled=!1)})}),this.tableData.splice(e,1)},cancel:function(){this.existModel=[],this.originModel=[],this.tableData=[],this.orderInfo={},this.$refs.orderInfo.resetFields(),this.$emit("update:show",!1),this.isVisible=!1},receiveData:function(e){var t=this;e.forEach(function(e){if(e.deliverItemCount=1,""!==e.productType&&(e.typeDisabled=!0),"1"==e.productType&&e.productItems&&e.productItems.length){console.log(t.tableData);var r=e.productItems.map(function(e){return e.productTempleteId}),o=t.tableData.filter(function(e){return r.indexOf(e.productTempleteId)>=0});o&&o.length>0?e.productItems.forEach(function(r){if(!o.find(function(e){return e.productTempleteItemId==r.productItemUuid&&e.productTempleteId==r.productTempleteId})){e.productTempleteItemId=r.productItemUuid,e.productTempleteId=r.productTempleteId,e.deliverItemRemark=r.deliverItemRemark,r.disabled=!0;var a=p()({},e);t.tableData.unshift(a),t.changeModel(a),console.log(t.tableData),t.selectIndex++}}):e.productItems.forEach(function(r){e.productTempleteItemId=r.productItemUuid,e.productTempleteId=r.productTempleteId,e.deliverItemRemark=r.deliverItemRemark,r.disabled=!0;var o=p()({},e);t.tableData.unshift(o),t.changeModel(o),console.log(t.tableData),t.selectIndex++})}else if("1"!=e.productType){if(!t.tableData.find(function(t){return t.productTempleteId==e.productTempleteId})){var a=p()({},e);t.$set(t.tableData,t.selectIndex,a),t.selectIndex++}}})},changeBrand:function(e,t){this.fromEdit=!0},changeModel:function(e,t,r){if("1"==e.productType&&e.productItems&&e.productItems.length){var o=[],a=this.tableData.filter(function(t){return t.productTempleteId==e.productTempleteId});a&&a.length&&a.forEach(function(e){o.push(e.productTempleteItemId)}),this.tableData.forEach(function(t){t.productTempleteId==e.productTempleteId&&t.productItems.forEach(function(e){var t=o.find(function(t){return t==e.productItemUuid});e.disabled=!!t})})}},changeItem:function(e,t){var r=this.tableData.filter(function(t){return t.productTempleteId===e.productTempleteId});r&&r.length&&this.existModel.forEach(function(e){e.forEach(function(e){"1"===e.productType&&e.productItems.forEach(function(e){var t=r.find(function(t){return t.productTempleteItemId===e.productItemUuid});e.disabled=!!t})})})},dealItemCount:function(e){var t=e.productItems.find(function(t){return t.productItemUuid==e.productTempleteItemId});if(t)return t.productCount},dealProductName:function(e,t){var r=t.find(function(t){return t.productTempleteId==e});if(r)return r.productName+" "+r.productModel},dealModelName:function(e){return e.remark?e.productModel+"「"+e.remark+"」":e.productModel},dealItemName:function(e){var t="";return"1"==e.productType&&e.productItems.length?(t="子件:",e.productItems.forEach(function(r,o){t+=r.productItemName+(o===e.productItems.length-1?"":"、")})):"0"==e.productType?t="小件":"2"==e.productType&&(t="单品"),t},getModelName:function(e,t){var r=e.find(function(e){return e.productTempleteId==t});if(r)return this.dealModelName(r)},getItemName:function(e,t){var r=e.find(function(e){return e.productItemUuid==t});if(r)return r.productItemName},validateField:function(e){this.$refs.orderInfo.validateField(e)},save:function(){var e=this;1==this.openType&&this.forbidden?this.$alert("此商户存在未审核通过的出库单，请审核通过后再新增出库单","提示",{confirmButtonText:"确定"}):this.$refs.orderInfo.validate(function(t){if(t){if(!e.tableData.length)return void e.$message({message:"请补全货物信息",type:"warning"});var r=!0,o=!1,l=void 0;try{for(var n,d=s()(e.tableData);!(r=(n=d.next()).done);r=!0){var i=n.value;if(!i||!i.productTempleteId||""===i.productTempleteId)return void e.$message({message:"请补全货物信息",type:"warning"})}}catch(e){o=!0,l=e}finally{try{!r&&d.return&&d.return()}finally{if(o)throw l}}if(e.orderInfo.customerAddress&&(!e.orderInfo.customerLat||!e.orderInfo.customerLng))return void e.$message({message:"请在地图上选择客户位置信息",type:"warning"});var u=!0,c=!1,p=void 0;try{for(var m,f=s()(e.tableData);!(u=(m=f.next()).done);u=!0){var h=m.value;h.deliverItemRemark&&h.deliverItemRemark.length?h.findStorageFlag=1:h.findStorageFlag=0}}catch(e){c=!0,p=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw p}}e.orderInfo.goodsWarehouseUuid=e.orderInfo.warehouseUuid?e.orderInfo.warehouseUuid:Object(y.b)("warehouseUuid");var I=a()({},e.orderInfo,{goodsDeliverItems:e.tableData});e.isSaveing=!0,Object(b.n)(I).then(function(t){if(e.isSaveing=!1,!t.error){var r=1==e.openType?"新增":"编辑";e.$message({message:r+"成功!",type:"success"}),e.cancel(),e.queryList()}})}})},uploadProd:function(){this.importVisible=!0},queryList:function(){this.$emit("search",this.searchParams)},chooseAddress:function(e){this.isMapShow=!0,this.addressInfo={lat:e.customerLat,lng:e.customerLng,address:e.customerAddress}},getAddress:function(e,t,r){this.orderInfo.customerLat=e,this.orderInfo.customerLng=t,this.orderInfo.customerAddress=r,this.$refs.address.$el.children[0].focus(),this.$refs.address.$el.children[0].blur(),console.log(this.orderInfo)},typeFormatter:function(e){return"0"==e.productType?"小件":"1"==e.productType?"套件":"2"==e.productType?"单品":""}},components:{CommonTable:h.a,TemplateCreate:v.default,TemplateImport:g.default,GMap:f.default,TemplateSelect:I.default}},D=r("wqwC"),_=r.n(D);var x=function(e){r("XefZ")},k=r("C7Lr")(w,_.a,!1,x,null,null);t.default=k.exports},XefZ:function(e,t){},wqwC:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-dialog",{attrs:{title:(1==e.openType?"新增":"编辑")+"出库单",visible:e.isVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"lock-scroll":!0,width:"95%",top:"5vh"},on:{"update:visible":function(t){e.isVisible=t},close:e.cancel}},[r("el-form",{ref:"orderInfo",attrs:{model:e.orderInfo,rules:e.orderFormRules,"label-width":"80px"}},[r("el-row",[r("el-col",{attrs:{span:5}},[r("el-form-item",{attrs:{label:"商户",prop:"merchants"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择商户"},on:{change:e.changeMerchants},model:{value:e.orderInfo.goodsDeliverMerchantUuid,callback:function(t){e.$set(e.orderInfo,"goodsDeliverMerchantUuid",t)},expression:"orderInfo.goodsDeliverMerchantUuid"}},e._l(e.merchantsList,function(e,t){return r("el-option",{key:t,attrs:{disabled:e.disabled,label:e.userName,value:e.userUuid}})}),1)],1)],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("el-form-item",{attrs:{label:"订单类型",prop:"goodsDeliverType"}},[r("el-select",{attrs:{placeholder:"请选择出库单单类型"},on:{change:e.deliverTypeChange},model:{value:e.orderInfo.goodsDeliverType,callback:function(t){e.$set(e.orderInfo,"goodsDeliverType",t)},expression:"orderInfo.goodsDeliverType"}},e._l(e.goodsDeliverType,function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"送货日期",prop:"goodsDeliverDate"}},[r("el-date-picker",{staticClass:"w100p",attrs:{align:"right",type:"date",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.orderInfo.goodsDeliverDate,callback:function(t){e.$set(e.orderInfo,"goodsDeliverDate",t)},expression:"orderInfo.goodsDeliverDate"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("el-form-item",{class:"1"==e.orderInfo.goodsDeliverType?"infoRequired":"",attrs:{label:"客户姓名",prop:"customerName"}},[r("el-input",{attrs:{maxlength:"200"},on:{blur:function(t){return e.validateField("customerName")}},model:{value:e.orderInfo.customerName,callback:function(t){e.$set(e.orderInfo,"customerName",t)},expression:"orderInfo.customerName"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("el-form-item",{class:"1"==e.orderInfo.goodsDeliverType?"infoRequired":"",attrs:{label:"客户电话",prop:"customerTelephone"}},[r("el-input",{attrs:{placeholder:"固话:区号-号码"},on:{blur:function(t){return e.validateField("customerTelephone")}},model:{value:e.orderInfo.customerTelephone,callback:function(t){e.$set(e.orderInfo,"customerTelephone",t)},expression:"orderInfo.customerTelephone"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-form-item",{class:"1"==e.orderInfo.goodsDeliverType?"infoRequired":"",attrs:{label:"客户地址",prop:"customerAddress"}},[r("el-col",{staticClass:"pos-r"},[r("el-input",{ref:"address",attrs:{type:"textarea",autosize:{maxRows:3},maxlength:"200",resize:"none",disabled:!e.orderInfo.customerLat||!e.orderInfo.customerLng},on:{blur:function(t){return e.validateField("customerAddress")}},model:{value:e.orderInfo.customerAddress,callback:function(t){e.$set(e.orderInfo,"customerAddress",t)},expression:"orderInfo.customerAddress"}}),e._v(" "),r("i",{staticClass:"el-icon-location pos-a posBtn",on:{click:function(t){return e.chooseAddress(e.orderInfo)}}})],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"备注",prop:"goodsDeliverRemark"}},[r("el-input",{staticClass:"create_textarea",attrs:{type:"textarea",autosize:{maxRows:3},maxlength:"200",resize:"none",placeholder:"请输入出库单备注，最长200字符"},model:{value:e.orderInfo.goodsDeliverRemark,callback:function(t){e.$set(e.orderInfo,"goodsDeliverRemark",t)},expression:"orderInfo.goodsDeliverRemark"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("el-form-item",{attrs:{label:"电梯",prop:"customerLiftFlag"}},[r("el-radio",{attrs:{label:"0"},model:{value:e.orderInfo.customerLiftFlag,callback:function(t){e.$set(e.orderInfo,"customerLiftFlag",t)},expression:"orderInfo.customerLiftFlag"}},[e._v("有")]),e._v(" "),r("el-radio",{attrs:{label:"1"},model:{value:e.orderInfo.customerLiftFlag,callback:function(t){e.$set(e.orderInfo,"customerLiftFlag",t)},expression:"orderInfo.customerLiftFlag"}},[e._v("无")])],1)],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("el-form-item",{attrs:{label:"是否安装",prop:"customerNeedInstall"}},[r("el-radio",{attrs:{label:"0"},model:{value:e.orderInfo.customerNeedInstall,callback:function(t){e.$set(e.orderInfo,"customerNeedInstall",t)},expression:"orderInfo.customerNeedInstall"}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:"1"},model:{value:e.orderInfo.customerNeedInstall,callback:function(t){e.$set(e.orderInfo,"customerNeedInstall",t)},expression:"orderInfo.customerNeedInstall"}},[e._v("否")])],1)],1)],1),e._v(" "),r("el-row",[r("common-table",{attrs:{flex:400}},[r("template",{slot:"table"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isListLoading,expression:"isListLoading"}],ref:"orderTable",attrs:{height:"100%",stripe:"",border:!0,data:e.tableData}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"50",fixed:"left","header-align":"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"品牌",prop:"productBrand","min-width":"100"}}),e._v(" "),r("el-table-column",{attrs:{label:"货品名称","min-width":"130",prop:"productName","header-align":"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"子件","min-width":"140","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.productType?r("el-tooltip",{attrs:{placement:"top",effect:"light",enterable:"","visible-arrow":!1}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("div",[e._v("\n                    "+e._s(e.getItemName(t.row.productItems,t.row.productTempleteItemId))+"\n                  ")])]),e._v(" "),"1"==t.row.productType?r("el-select",{on:{change:function(r){return e.changeItem(t.row,t.$index)}},model:{value:t.row.productTempleteItemId,callback:function(r){e.$set(t.row,"productTempleteItemId",r)},expression:"scope.row.productTempleteItemId"}},e._l(t.row.productItems,function(e,t){return r("el-option",{key:t,attrs:{disabled:e.disabled,label:e.productItemName,value:e.productItemUuid}})}),1):e._e()],1):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"型号","min-width":"130",prop:"productModel","header-align":"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"规格","min-width":"140",prop:"productStandard"}}),e._v(" "),r("el-table-column",{attrs:{label:"颜色","min-width":"80",prop:"productColor"}}),e._v(" "),r("el-table-column",{attrs:{label:"货品类型",prop:"productType",formatter:e.typeFormatter,"min-width":"110"}}),e._v(" "),r("el-table-column",{attrs:{label:"数量","min-width":"100","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{staticClass:"productCount",attrs:{"controls-position":"right",min:1,precision:0,max:"0"==t.row.productType||"2"==t.row.productType?t.row.productCount:e.dealItemCount(t.row),size:"mini"},model:{value:t.row.deliverItemCount,callback:function(r){e.$set(t.row,"deliverItemCount",r)},expression:"scope.row.deliverItemCount"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"库存数量",width:"80","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.productType?r("span",[e._v(e._s(e.dealItemCount(t.row)))]):e._e(),e._v(" "),"0"==t.row.productType||"2"==t.row.productType?r("span",[e._v(e._s(t.row.productCount))]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"备注","min-width":"100",prop:"deliverItemRemark","show-tooltip-when-overflow":!0}}),e._v(" "),r("el-table-column",{attrs:{width:"100","render-header":e.renderHeader,fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",rules:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.deleteRow(t.$index,t.row)}}},[e._v("\n                删除\n              ")])]}}])})],1)],1)],2)],1),e._v(" "),r("el-row",{staticStyle:{"margin-top":"10px"}},[r("el-col",{staticClass:"flex-right",attrs:{span:24}},[r("el-button",{attrs:{type:"primary",loading:e.isSaveing},on:{click:function(t){return e.save()}}},[e._v("提交")]),e._v(" "),r("el-button",{on:{click:function(t){return e.cancel()}}},[e._v("取消")])],1)],1)],1)],1),e._v(" "),r("g-map",{attrs:{show:e.isMapShow,addressInfo:e.addressInfo},on:{"update:show":function(t){e.isMapShow=t},getAddress:e.getAddress}}),e._v(" "),r("template-select",{attrs:{show:e.isTemplateShow,merchantsList:e.merchantsList,merchantId:e.orderInfo.goodsDeliverMerchantUuid},on:{"update:show":function(t){e.isTemplateShow=t},sendData:e.receiveData}})],1)},staticRenderFns:[]}}});
//# sourceMappingURL=61.4177214506c7c2858d8d.js.map