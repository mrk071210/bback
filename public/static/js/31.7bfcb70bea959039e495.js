webpackJsonp([31,90],{"5J32":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s=a("a3Yh"),r=a.n(s),i=a("QPLA"),n=a("Jky9"),u=a("Jns3"),l=a("0+j4"),h=a("aIe1"),c=a("I8tE"),d=a("KWYu"),p=a("h+R9"),f={name:"WarehouseManager",mixins:[a("dF+P").a],data:function(){return{warehouseList:this.$store.getters.warehouseList,tableData:[],orgnization:[],cascaderOrg:[],selectRow:[],isListLoading:!1,isCreateFormVisible:!1,clickedNodeData:{},pagination:{pageNum:1,pageSize:10,total:0},searchParams:{},isCreate:!0}},mounted:function(){this.queryList(),this.getOrgList()},methods:(o={getOrgList:function(){var e=this;Object(d.c)().then(function(t){e.orgnization=t,t.forEach(function(e){e.value=e.id,e.label=e.orgName}),e.cascaderOrg=Object(i.a)(t),e.deleteNullChildren(e.cascaderOrg)})},queryList:function(){this.updateTable({pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize})},changePage:function(e){this.pagination.pageNum=e,this.queryList(this.searchParams)},indexMethod:function(e){return e+1+(this.pagination.pageNum-1)*this.pagination.pageSize},updateTable:function(e){var t=this;this.isListLoading=!0,Object(c.o)(e).then(function(a){t.tableData=a.item,t.pagination.total=a.total,t.pagination.pageNum=a.pageNum,t.pagination.pageSize=a.pageSize,t.isListLoading=!1,0==a.item.length&&a.pageNum>1&&(t.pagination.pageNum--,e.pageNum--,t.updateTable(e))})},formatOrgName:function(e){var t=this.orgnization.find(function(t){return t.id===e.warehouseOrgUuid});return t?t.orgName:""},handleAdd:function(){this.isCreate=!0,this.isCreateFormVisible=!0,this.clickedNodeData={}},isButtonIsDisabled:function(){return!!this.selectRow.length}},r()(o,"changePage",function(e){this.pagination.pageNum=e,this.queryList(this.searchParams)}),r()(o,"handleEdit",function(e,t){this.clickedNodeData=t,this.isCreate=!1,this.isCreateFormVisible=!0}),r()(o,"handleDel",function(e,t){var a=this;this.$confirm("删除仓库后该仓库下所有数据将不可见，确认删除该仓库吗?","提示",{type:"warning"}).then(function(){var e={warehouseIds:[t.warehouseUuid]};Object(c.e)(e).then(function(e){e.error||(a.$message({message:"删除成功！",type:"success"}),a.queryList())})}).catch(function(){})}),r()(o,"deleteNullChildren",function(e){var t=this;e.forEach(function(e){e.children&&e.children.length>0?t.deleteNullChildren(e.children):e.children&&0==e.children.length&&delete e.children})}),o),components:{NavButton:n.a,NavPremissonButton:u.a,CommonWrapper:l.a,CommonTable:h.a,WarehouseCreate:p.default}},w=a("DOjA"),g=a.n(w);var m=function(e){a("qBts")},b=a("C7Lr")(f,g.a,!1,m,"data-v-5d940b5a",null);t.default=b.exports},DOjA:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("nav-button",[a("el-button-group",[a("el-button",{attrs:{icon:"fdddfont icon-add-new"},nativeOn:{click:function(t){return e.handleAdd()}}},[e._v("新增")])],1)],1),e._v(" "),a("common-wrapper",[a("common-table",{attrs:{flex:230}},[a("template",{slot:"table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isListLoading,expression:"isListLoading"}],ref:"roleTable",attrs:{height:"100%",stripe:"",border:!0,"tooltip-effect":"light",data:e.tableData},on:{"selection-change":function(t){return e.selectRow=t}}},[a("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouseName",sortable:"",label:"名称",width:"150","show-tooltip-when-overflow":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouseArea",sortable:"",label:"所属地区",width:"150","show-tooltip-when-overflow":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouseOrgUuid",sortable:"",label:"所属机构",formatter:e.formatOrgName,width:"150","show-tooltip-when-overflow":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouseAddress",label:"详细地址","min-width":"200","show-tooltip-when-overflow":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouseDesc",label:"描述","min-width":"200","show-tooltip-when-overflow":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"编辑",placement:"bottom"}},[a("el-button",{attrs:{size:"mini",round:"",icon:"fdddfont icon-modify"},on:{click:function(a){return a.stopPropagation(),e.handleEdit(t.$index,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"删除",placement:"bottom"}},[a("el-button",{attrs:{size:"mini",round:"",icon:"fdddfont icon-delete"},on:{click:function(a){return a.stopPropagation(),e.handleDel(t.$index,t.row)}}})],1)]}}])})],1)],1),e._v(" "),a("template",{slot:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.pagination.pageNum,"page-size":e.pagination.pageSize,total:e.pagination.total},on:{"update:currentPage":function(t){return e.$set(e.pagination,"pageNum",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageNum",t)},"current-change":e.changePage}})],1)],2)],1),e._v(" "),a("warehouse-create",{attrs:{show:e.isCreateFormVisible,isCreate:e.isCreate,orgList:e.orgnization,nodeData:e.clickedNodeData,org:e.cascaderOrg},on:{"update:show":function(t){e.isCreateFormVisible=t},updateTree:e.queryList}})],1)},staticRenderFns:[]}},TuSL:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"500px",title:(e.isCreate?"新增":"编辑")+"仓库",visible:e.isVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.isVisible=t},close:e.cancel}},[a("el-form",{ref:"warehouseInfo",staticClass:"text-c",attrs:{inline:"",model:e.warehouseInfo,rules:e.formRules,"label-width":"80px"}},[a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"名称",prop:"warehouseName"}},[a("el-input",{staticClass:"w160",attrs:{maxlength:"30",placeholder:""},model:{value:e.warehouseInfo.warehouseName,callback:function(t){e.$set(e.warehouseInfo,"warehouseName",t)},expression:"warehouseInfo.warehouseName"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"所属地区",prop:"warehouseArea"}},[a("el-input",{staticClass:"w160",attrs:{maxlength:"50",placeholder:""},model:{value:e.warehouseInfo.warehouseArea,callback:function(t){e.$set(e.warehouseInfo,"warehouseArea",t)},expression:"warehouseInfo.warehouseArea"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"所属机构",prop:"warehouseOrgUuid"}},[a("el-cascader",{staticClass:"w160",attrs:{options:e.options,"change-on-select":""},model:{value:e.warehouseInfo.warehouseOrgUuidList,callback:function(t){e.$set(e.warehouseInfo,"warehouseOrgUuidList",t)},expression:"warehouseInfo.warehouseOrgUuidList"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"pos-r"},[a("el-form-item",{attrs:{label:"详细地址",prop:"warehouseAddress"}},[a("el-input",{ref:"address",staticClass:"w160",attrs:{disabled:!e.warehouseInfo.warehouseAddress,type:"textarea",autosize:{maxRows:7},maxlength:"200",resize:"none",placeholder:"请输入仓库详细地址，最长200字符"},model:{value:e.warehouseInfo.warehouseAddress,callback:function(t){e.$set(e.warehouseInfo,"warehouseAddress",t)},expression:"warehouseInfo.warehouseAddress"}}),e._v(" "),a("i",{staticClass:"el-icon-location pos-a posButton",on:{click:function(t){return e.chooseAddress(e.warehouseInfo)}}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"描述",prop:"warehouseDesc"}},[a("el-input",{staticClass:"w160",attrs:{type:"textarea",autosize:{maxRows:7},maxlength:"200",resize:"none",placeholder:"请输入描述,最长200字符"},model:{value:e.warehouseInfo.warehouseDesc,callback:function(t){e.$set(e.warehouseInfo,"warehouseDesc",t)},expression:"warehouseInfo.warehouseDesc"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")])],1)],1)],1)],1),e._v(" "),a("g-map",{attrs:{show:e.isMapShow,addressInfo:e.addressInfo},on:{"update:show":function(t){e.isMapShow=t},getAddress:e.getAddress}})],1)},staticRenderFns:[]}},"h+R9":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("aA9S"),s=a.n(o),r=a("I8tE"),i=a("XQ4b"),n=a("Yqxs"),u={name:"WarehouseCreate",data:function(){return{warehouseInfo:{warehouseName:"",warehouseArea:"",warehouseOrgUuid:"",warehouseAddress:"",warehouseDesc:"",warehouseLat:"",warehouseOrgUuidList:[]},isVisible:!1,formRules:{warehouseName:[{required:!0,message:"请输入仓库名称",trigger:"blur"}],warehouseArea:[{required:!0,message:"请输入仓库区域",trigger:"blur"}],warehouseAddress:[{required:!0,message:"请选择详细地址",trigger:"blur"}],warehouseOrgUuidList:[{required:!0,message:"请选择仓库所属机构",trigger:"blur"}],warehouseDesc:[{min:0,max:2e3,message:"描述长度请不要超过2000字",trigger:"change"}]},isMapShow:!1,addressInfo:{},options:[]}},props:{show:{type:Boolean,default:!1},org:{type:Array,required:!0},orgList:{type:Array,required:!0},nodeData:{type:Object,required:!0},isCreate:{type:Boolean,required:!0}},watch:{show:function(e){e&&(this.isCreate||this.setToEditState()),this.isVisible=e},org:function(e){this.options=e}},methods:{setToEditState:function(){this.warehouseInfo=s()({},this.warehouseInfo,this.nodeData),this.findPid(this.warehouseInfo.warehouseOrgUuid)},chooseAddress:function(e){this.isMapShow=!0,this.addressInfo={lat:e.warehouseLat||null,lng:e.warehouseLng||null,address:e.warehouseAddress}},getAddress:function(e,t,a){this.warehouseInfo.warehouseLat=e,this.warehouseInfo.warehouseLng=t,this.warehouseInfo.warehouseAddress=a,this.$refs.address.$el.children[0].focus(),this.$refs.address.$el.children[0].blur(),console.log(this.warehouseInfo)},save:function(){var e=this;this.$refs.warehouseInfo.validate(function(t){t&&(e.warehouseInfo.warehouseOrgUuid=e.warehouseInfo.warehouseOrgUuidList[e.warehouseInfo.warehouseOrgUuidList.length-1],Object(r.H)(e.warehouseInfo).then(function(t){t.error||e.$message({message:(e.isCreate?"新增":"修改")+"成功！",type:"success"}),n.a.dispatch("getWarehouseList"),e.cancel(),e.$emit("updateTree")}))})},cancel:function(){this.warehouseInfo={warehouseName:"",warehouseArea:"",warehouseOrgUuid:"",warehouseAddress:"",warehouseDesc:"",warehouseLat:"",warehouseOrgUuidList:[]},this.$refs.warehouseInfo.resetFields(),this.$emit("update:show",!1),this.isVisible=!1},findPid:function(e){var t=this.orgList.find(function(t){return t.id==e});t&&this.warehouseInfo.warehouseOrgUuidList.unshift(t.id),""==t.pId||t.root||this.findPid(t.pId)}},components:{GMap:i.default}},l=a("TuSL"),h=a.n(l);var c=function(e){a("opga")},d=a("C7Lr")(u,h.a,!1,c,"data-v-46948a45",null);t.default=d.exports},opga:function(e,t){},qBts:function(e,t){}});
//# sourceMappingURL=31.7bfcb70bea959039e495.js.map