webpackJsonp([71],{"/DMk":function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{width:"600px",title:(e.isCreate?"新增":"编辑")+"盘点任务",visible:e.isVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.isVisible=t},close:e.cancel}},[r("el-form",{ref:"checkForm",attrs:{model:e.checkForm,rules:e.formRules,"label-width":"80px"}},[r("el-row",{attrs:{type:"flex",justify:"space-between"}},[r("el-col",{attrs:{span:12}},[r("el-row",[r("el-form-item",{attrs:{label:"仓库",prop:"warehouseUuid"}},[r("el-select",{staticClass:"w100p",attrs:{placeholder:"请选择仓库"},on:{change:e.warehouseChange},model:{value:e.checkForm.warehouseUuid,callback:function(t){e.$set(e.checkForm,"warehouseUuid",t)},expression:"checkForm.warehouseUuid"}},e._l(e.warehouseList,function(e,t){return r("el-option",{key:t,attrs:{label:e.warehouseName,value:e.warehouseUuid}})}),1)],1)],1),e._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"商户",prop:"merchants"}},[r("el-select",{staticClass:"w100p",attrs:{filterable:"",clearable:"",placeholder:"请选择商户"},on:{change:e.merchantsChange},model:{value:e.checkForm.merchantUuid,callback:function(t){e.$set(e.checkForm,"merchantUuid",t)},expression:"checkForm.merchantUuid"}},e._l(e.merchantsList,function(e,t){return r("el-option",{key:t,attrs:{label:e.userName,value:e.userUuid}})}),1)],1)],1),e._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"品牌",prop:"brand"}},[r("el-select",{staticClass:"w100p",attrs:{filterable:"",clearable:"",placeholder:"请选择品牌"},model:{value:e.checkForm.brand,callback:function(t){e.$set(e.checkForm,"brand",t)},expression:"checkForm.brand"}},e._l(e.brandList,function(e,t){return r("el-option",{key:t,staticClass:"radio",attrs:{value:e,label:e}})}),1)],1)],1),e._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"开始日期",prop:"beginDate"}},[r("el-date-picker",{staticClass:"w100p",attrs:{placeholder:"请选择开始日期",align:"right","unlink-panels":"",size:"mini",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.checkForm.beginDate,callback:function(t){e.$set(e.checkForm,"beginDate",t)},expression:"checkForm.beginDate"}})],1)],1),e._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"截止日期",prop:"endDate"}},[r("el-date-picker",{staticClass:"w100p",attrs:{placeholder:"请选择截止日期",align:"right","unlink-panels":"",size:"mini",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.checkForm.endDate,callback:function(t){e.$set(e.checkForm,"endDate",t)},expression:"checkForm.endDate"}})],1)],1),e._v(" "),r("el-row",{staticClass:"text-c"},[r("el-col",[r("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:11}},[r("common-wrapper",{staticClass:"treeArea"},[r("VuePerfectScrollbar",{staticClass:"scroll-area"},[r("el-tree",{ref:"tree",attrs:{"empty-text":"请选择需要盘点仓库",data:e.shelvesTreeData,"node-key":"id",props:e.defaultProps,"show-checkbox":!0,"default-checked-keys":e.checkedNodes,"default-expanded-keys":e.expandNodes},on:{check:e.handleCheckNode}})],1)],1)],1)],1)],1)],1)},staticRenderFns:[]}},d1Cm:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("HzJ8"),s=r.n(a),c=r("rVsN"),o=r.n(c),n=r("aA9S"),i=r.n(n),l=r("ryJa"),h=r.n(l),u=r("wppO"),d=r.n(u),m=(r("fBur"),r("uTPb"),r("0+j4")),f=r("QPLA"),p=r("I8tE"),k=r("4+6g"),b={name:"StockCheckCreat",data:function(){return{isVisible:!1,checkForm:{brand:"",merchantUuid:"",warehouseUuid:"",beginDate:"",endDate:"",shelvesList:[]},formRules:{warehouseUuid:[{required:!0,message:"请选择仓库",trigger:"blur"}],beginDate:[{required:!0,message:"请选择开始日期",trigger:"blur"}],endDate:[{required:!0,message:"请选择截止日期",trigger:"blur"}]},defaultProps:{label:"name"},brandList:[],modelBrand:[],merchantsList:[],shelvesTreeData:[],checkedNodes:[],expandNodes:[]}},props:{show:{type:Boolean,default:!1},isCreate:{type:Boolean,default:!0},warehouseList:{type:Array,required:!0},merchants:{type:Array,default:function(){return[]}},taskInfo:{type:Object},searchParams:{type:Object}},watch:{show:function(e){this.isVisible=e,!this.isCreate&&this.isVisible&&(this.checkForm=i()({},this.taskInfo),this.getMerchants(),this.getBrandModel({warehouseUuid:this.checkForm.warehouseUuid}),this.updateTree())}},methods:{getMerchants:function(){var e=this;return new o.a(function(t){var r={warehouseUuid:e.checkForm.warehouseUuid};Object(k.f)(r).then(function(r){r.error||(e.merchantsList=r,t())})})},getBrandModel:function(e){var t=this;Object(k.h)(e).then(function(e){e.error||(t.brandList=[],t.modelList=[],e.forEach(function(e,r){t.brandList.push(e.productBrand),e.productModel.forEach(function(e){t.modelList.push(e)})}),t.modelBrand=e)})},warehouseChange:function(){var e=this;this.getBrandModel({warehouseUuid:this.checkForm.warehouseUuid}),this.getMerchants().then(function(){e.checkForm.merchantUuid="",e.checkForm.brand="",e.updateTree()})},merchantsChange:function(e){this.checkForm.brand="",this.getBrandModel({warehouseUuid:this.checkForm.warehouseUuid,merchantUuid:e}),this.updateTree()},updateTree:function(){var e=this;this.checkForm.shelvesList=[],this.checkedNodes=[],this.expandNodes=[],Object(p.l)(this.checkForm).then(function(t){if(e.shelvesTreeData=Object(f.a)(t),t.forEach(function(t){""===t.pId&&e.expandNodes.push(t.id)}),!e.isCreate&&e.taskInfo.storageUuids){var r=e.taskInfo.storageUuids.split(","),a=[];if(r.length){var c=!0,o=!1,n=void 0;try{for(var i,l=s()(r);!(c=(i=l.next()).done);c=!0){var h=i.value;h=h.substring(1,h.length-1),a.push(h)}}catch(e){o=!0,n=e}finally{try{!c&&l.return&&l.return()}finally{if(o)throw n}}e.$refs.tree.setCheckedKeys(a)}}})},getOnlyChildrenNodes:function(e){return e.filter(function(e){return!e.children.length})},handleCheckNode:function(){var e=this.$refs.tree.getCheckedNodes();this.checkForm.shelvesList=e},save:function(){var e=this;this.$refs.checkForm.validate(function(t){if(t){if(e.checkForm.endDate&&e.checkForm.beginDate&&(h()(e.checkForm.endDate).isBefore(e.checkForm.beginDate)||h()(e.checkForm.endDate).isSame(e.checkForm.beginDate)))return void e.$message({message:"截止日期不能早于开始日期！",type:"warning"});e.handleCheckNode(),e.checkForm.shelvesList.length?(e.checkForm.warehouseName=e.warehouseList.find(function(t){return t.warehouseUuid===e.checkForm.warehouseUuid}).warehouseName,Object(p.v)(e.checkForm).then(function(t){if(!t.error){var r=e.isCreate?"新增":"编辑";e.$message({message:r+"盘点成功!",type:"success"}),e.cancel(),e.$emit("updateList",e.searchParams)}})):e.$message({message:"请选择要盘点的库位!",type:"warning"})}})},cancel:function(){this.shelvesTreeData=[],this.checkForm={},this.$refs.checkForm.resetFields(),this.$emit("update:show",!1),this.isVisible=!1}},components:{CommonWrapper:m.a,VuePerfectScrollbar:d.a}},g=r("/DMk"),v=r.n(g);var w=function(e){r("rfCV")},y=r("C7Lr")(b,v.a,!1,w,"data-v-74706b34",null);t.default=y.exports},rfCV:function(e,t){}});
//# sourceMappingURL=71.7e7950fb13257339da87.js.map